{% extends "base-adm.html" %}

{% block conteudo %}
<!-- <div class="admin-container">
    <div class="top-bar">
        <a href="{{ url_for('login.logout') }}"><button class="logout-btn"
                onclick="return confirm('Tem certeza que deseja sair?')">Logout</button></a>
    </div>

    <nav class="admin-nav">
        <button onclick="showContent('consultar')">Consultar</button>
        <button onclick="showContent('cadastrar')">Cadastrar Colaborador</button>
        <button onclick="showContent('relatorio')">Relatório</button>
    </nav>

    <section id="content-area" class="content-area">
        
    </section>
</div> 

<script>
    function showContent(page) {
        const content = {
            consultar: `
                <h2>Buscar Colaborador</h2>
                <form id="form-consultar" class="form-colaborador">
                    <div class="form-group">
                        <label>Matrícula:</label>
                        <input type="text" id="matricula" name="matricula" placeholder="Digite a matrícula">
                        <div id="resultado-consulta"></div>
                    </div>
                    <div class="form-actions">                    
                        <button type="submit">Consultar</button>
                    </div>
                </form>
            `,
            cadastrar: `
                <h2>Cadastrar Colaborador</h2>
                <form class="form-colaborador">
                    <div class="Cadastro_separador">
                        <div class="form-group">
                            <label>Matrícula</label>
                            <input type="text" name="matricula" placeholder="Matrícula">
                        </div>
                        <div class="form-group">
                            <label>Nome Completo</label>
                            <input type="text" name="nome" placeholder="Nome Completo">
                        </div>
                    </div>
                    <div class="form-group short">
                        <label>Administrador?</label>
                        <select name="administrador">
                            <option value="">Selecione</option>
                            <option value="1">Sim</option>
                            <option value="0">Não</option>
                        </select>
                    </div>
                    <div class="Cadastro_separador">
                        <div class="form-group">
                            <label>E-mail</label>
                            <input type="email" name="email" placeholder="E-mail">
                        </div>
                        <div class="form-group">
                            <label>Senha</label>
                            <input type="password" name="senha" placeholder="Senha (8 caracteres)">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit">Cadastrar</button>
                    </div>
                </form>
            `,

            /* editar: `
                <h2>Editar Colaborador</h2>
                <form onsubmit="buscarColaborador(event)" class="form-colaborador">
                    <div class="form-group">
                        <label for="cpfBusca">CPF</label>
                        <input type="text" id="cpfBusca" placeholder="Digite o CPF">
                    </div>
                    <div class="form-group">
                        <label for="matriculaBusca">Matrícula</label>
                        <input type="text" id="matriculaBusca" placeholder="Digite a Matrícula">
                    </div>
                    <div class="form-actions">
                        <button type="submit">Buscar</button>
                    </div>
                </form>

                <form id="editarForm" class="form-colaborador" style="display:none;">
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" name="nome">
                    </div>
                    <div class="form-group">
                        <label>CPF</label>
                        <input type="text" name="cpf">
                    </div>
                    <div class="form-group">
                        <label>E-mail</label>
                        <input type="email" name="email">
                    </div>
                    <div class="form-group">
                        <label>Matrícula</label>
                        <input type="text" name="matricula">
                    </div>
                    <div class="form-group short">
                        <label>Data de Nascimento</label>
                        <input type="date" name="data_nascimento">
                    </div>
                    <div class="form-group short">
                        <label>Data de Admissão</label>
                        <input type="date" name="admissao">
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" name="senha">
                    </div>
                    <div class="form-group short">
                        <label>Administrador?</label>
                        <select name="administrador">
                            <option value="">Selecione</option>
                            <option value="1">Sim</option>
                            <option value="0">Não</option>
                        </select>
                    </div>
                    <div class="form-group short">
                        <label>Ativo?</label>
                        <select name="ativo">
                            <option value="">Selecione</option>
                            <option value="1">Sim</option>
                            <option value="0">Não</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit">Confirmar</button>
                        <button type="button" onclick="cancelarEdicao()">Cancelar</button>
                    </div>
                </form>
            `, */

            relatorio: "<h2>Relatórios</h2><p>Em breve!</p>"
        };

        document.getElementById("content-area").innerHTML = content[page] || "";
            }
            document.getElementById("content-area").addEventListener("submit", function(e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => data[key] = value);

            fetch("/adm/consultar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                const resultadoDiv = document.getElementById("resultado-consulta");

                if (result.erro) {
                    resultadoDiv.innerHTML = `<p style="color:red;">${result.erro}</p>`;
                } else {
                    resultadoDiv.innerHTML = `
                        <p><strong>Nome:</strong> ${result.nome}</p>
                        <p><strong>Matrícula:</strong> ${result.matricula}</p>
                        <p><strong>E-mail:</strong> ${result.email || 'N/A'}</p>
                        <p><strong>Administrador:</strong> ${result.administrador ? 'Sim' : 'Não'}</p>
                        <p><strong>Ativo:</strong> ${result.ativo ? 'Sim' : 'Não'}</p>
                        <button onclick="editarColaborador('${result.matricula}')">Editar</button>
                    `;
                }
            })
            .catch(() => {
                document.getElementById("resultado-consulta").innerHTML = "<p style='color:red;'>Erro ao consultar.</p>";
            });
        });
        function editarColaborador(matricula) {
            fetch(`/adm/editar/${matricula}`)  // ✅ Garanta que é /adm/editar/
                .then(response => response.json())
                .then(colaborador => {
                    const formularioEdicao = `
                        <h2>Editar Colaborador</h2>
                        <form id="form-editar-colaborador">
                            <input type="hidden" name="matricula" value="${colaborador.matricula}">
                            
                            <div class="form-group">
                                <label>Nome Completo</label>
                                <input type="text" name="nome" value="${colaborador.nome || ''}">
                            </div>

                            <div class="form-group short">
                                <label>Administrador?</label>
                                <select name="administrador">
                                    <option value="1" ${colaborador.administrador ? 'selected' : ''}>Sim</option>
                                    <option value="0" ${!colaborador.administrador ? 'selected' : ''}>Não</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>E-mail</label>
                                <input type="email" name="email" value="${colaborador.email || ''}" disabled>
                            </div>

                            <div class="form-group short">
                                <label>Ativo?</label>
                                <select name="ativo">
                                    <option value="1" ${colaborador.ativo ? 'selected' : ''}>Sim</option>
                                    <option value="0" ${!colaborador.ativo ? 'selected' : ''}>Não</option>
                                </select>
                            </div>

                            <div class="form-actions">
                                <button type="submit">Salvar Alterações</button>
                                <button type="button" onclick="showContent('consultar')">Cancelar</button>
                            </div>
                        </form>
                    `;
                    document.getElementById("content-area").innerHTML = formularioEdicao;
                })
                .catch(err => {
                    console.error("Erro ao buscar dados:", err);
                    alert("Erro ao carregar os dados do colaborador.");
                });
        }

    // Evento de submit para salvar alterações
    document.addEventListener("submit", function(e) {
        if (e.target.id === "form-editar-colaborador") {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = {};
            formData.forEach((value, key) => data[key] = value);

            fetch("/adm/editar", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.sucesso) {
                    alert("Dados atualizados com sucesso!");
                    showContent('consultar');
                } else {
                    alert("Erro ao atualizar: " + result.erro);
                }
            });
        }
    });
</script> -->

{% endblock %}