{% extends 'base-ponto.html' %}
{% block conteudo %}
<div class="ponto-container">
    <div class="nav-home">
        <a href="/login"><button class="login-btn">Login</button></a>
    </div>

    <div class="clock" id="clock">
        <span class="hours">00</span><span class="separadorg">:</span></span><span class="minutes">00</span><span
            class="separador">:</span><span class="seconds">00</span>
    </div>

    <div class="box-ponto">
        <form class="form-ponto" method="POST" action="/">
            <input type="text" name="matricula" placeholder="Digite sua Matrícula" required>
            <button type="submit">Confirmar</button>
        </form>
        <!-- Mensagem de sucesso ou erro -->
        {% if mensagem %}
        <p class="msg">{{ mensagem }}</p>
        {% endif %}
    </div>
</div>

<script>
    function getServerTime() {
        fetch('/hora-servidor')
            .then(response => response.json())
            .then(data => {
                const serverTime = new Date(data.hora);

                function updateClock() {
                    serverTime.setSeconds(serverTime.getSeconds() + 1);
                    const hours = String(serverTime.getHours()).padStart(2, '0');
                    const minutes = String(serverTime.getMinutes()).padStart(2, '0');
                    const seconds = String(serverTime.getSeconds()).padStart(2, '0');

                    document.querySelector('.hours').textContent = hours;
                    document.querySelector('.minutes').textContent = minutes;
                    document.querySelector('.seconds').textContent = seconds;
                }

                setInterval(updateClock, 1000);
                updateClock();
            })
            .catch(err => {
                console.error('Erro ao obter hora do servidor:', err);
                fallbackToClientTime();
            });
    }

    function fallbackToClientTime() {
        // Relógio padrão do navegador como fallback
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            document.querySelector('.hours').textContent = hours;
            document.querySelector('.minutes').textContent = minutes;
            document.querySelector('.seconds').textContent = seconds;
        }
        setInterval(updateClock, 1000);
        updateClock();
    }

    // Iniciar com a hora do servidor
    getServerTime();
</script>
{% endblock %}