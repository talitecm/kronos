{% extends "base-adm.html" %}

{% block conteudo %}
<div class="admin-container">
    <div class="top-bar">
        <a href="{{ url_for('login.logout') }}"><button class="logout-btn"
                onclick="return confirm('Tem certeza que deseja sair?')">Logout</button></a>
    </div>

    <nav class="admin-nav">
        <button onclick="showContent('consultar')">Consultar</button>
        <button onclick="showContent('cadastrar')">Cadastrar Colaborador</button>
        <button onclick="showContent('relatorio')">Relatório</button>
    </nav>

    <section id="content-area" class="content-area">
        <!-- Conteúdo dinâmico vai aqui -->
    </section>
</div>

<script>
    function showContent(page) {
        const content = {
            consultar: `
                <h2>Buscar Colaborador</h2>
                <form id="form-consultar" class="form-colaborador">
                    <div class="form-group">
                        <label for="matricula">Matrícula:</label>
                        <input type="text" id="matricula" name="matricula" placeholder="Digite a matrícula">
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="consultarColaborador()">Consultar</button>
                    </div>
                </form>
                <div id="resultado-consulta"></div>
            `,

            cadastrar: `
                <h2>Cadastrar Colaborador</h2>
                <form class="form-colaborador">
                    <div class="Cadastro_separador">
                        <div class="form-group">
                            <label>Matrícula</label>
                            <input type="text" name="matricula" placeholder="Matrícula">
                        </div>
                        <div class="form-group">
                            <label>Nome Completo</label>
                            <input type="text" name="nome" placeholder="Nome Completo">
                        </div>
                    </div>
                    <div class="form-group short">
                        <label>Administrador?</label>
                        <select name="administrador">
                            <option value="">Selecione</option>
                            <option value="1">Sim</option>
                            <option value="0">Não</option>
                        </select>
                    </div>
                    <div class="Cadastro_separador">
                        <div class="form-group">
                            <label>E-mail</label>
                            <input type="email" name="email" placeholder="E-mail">
                        </div>
                        <div class="form-group">
                            <label>Senha</label>
                            <input type="password" name="senha" placeholder="Senha (8 caracteres)">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit">Cadastrar</button>
                    </div>
                </form>
            `,

            /* editar: `
                <h2>Editar Colaborador</h2>
                <form onsubmit="buscarColaborador(event)" class="form-colaborador">
                    <div class="form-group">
                        <label for="cpfBusca">CPF</label>
                        <input type="text" id="cpfBusca" placeholder="Digite o CPF">
                    </div>
                    <div class="form-group">
                        <label for="matriculaBusca">Matrícula</label>
                        <input type="text" id="matriculaBusca" placeholder="Digite a Matrícula">
                    </div>
                    <div class="form-actions">
                        <button type="submit">Buscar</button>
                    </div>
                </form>

                <form id="editarForm" class="form-colaborador" style="display:none;">
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" name="nome">
                    </div>
                    <div class="form-group">
                        <label>CPF</label>
                        <input type="text" name="cpf">
                    </div>
                    <div class="form-group">
                        <label>E-mail</label>
                        <input type="email" name="email">
                    </div>
                    <div class="form-group">
                        <label>Matrícula</label>
                        <input type="text" name="matricula">
                    </div>
                    <div class="form-group short">
                        <label>Data de Nascimento</label>
                        <input type="date" name="data_nascimento">
                    </div>
                    <div class="form-group short">
                        <label>Data de Admissão</label>
                        <input type="date" name="admissao">
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" name="senha">
                    </div>
                    <div class="form-group short">
                        <label>Administrador?</label>
                        <select name="administrador">
                            <option value="">Selecione</option>
                            <option value="1">Sim</option>
                            <option value="0">Não</option>
                        </select>
                    </div>
                    <div class="form-group short">
                        <label>Ativo?</label>
                        <select name="ativo">
                            <option value="">Selecione</option>
                            <option value="1">Sim</option>
                            <option value="0">Não</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit">Confirmar</button>
                        <button type="button" onclick="cancelarEdicao()">Cancelar</button>
                    </div>
                </form>
            `, */

            relatorio: "<h2>Relatórios</h2><p>Em breve!</p>"
        };

        document.getElementById("content-area").innerHTML = content[page] || "";
    }
    function consultarColaborador() {
        const cpf = document.getElementById("cpf").value.trim();
        const matricula = document.getElementById("matricula").value.trim();

        fetch("/adm/consultar", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ cpf, matricula })
        })
            .then(response => response.json())
            .then(data => {
                const resultado = document.getElementById("resultado-consulta");
                if (data.erro) {
                    resultado.innerHTML = `<p style="color:red;">${data.erro}</p>
                                   <button onclick="showContent('consultar')">Nova Consulta</button>`;
                } else {
                    resultado.innerHTML = `
                <div class="resultado-box">
                    <p><strong>Nome:</strong> ${data.nome}</p>
                    <p><strong>Matrícula:</strong> ${data.matricula}</p>
                    <button onclick="window.location.href='/adm/editar/${data.matricula}'">Editar</button>
                    <div class="nova-consulta">
                        <button onclick="showContent('consultar')">Nova Consulta</button>
                    </div>
                </div>
            `;
                }
            })
            .catch(() => {
                document.getElementById("resultado-consulta").innerHTML = "<p style='color:red;'>Erro na consulta.</p>";
            });
    }
</script>

{% endblock %}